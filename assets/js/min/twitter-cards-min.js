function convertToLinks(t){var e,a,r,n;return a=/(\b(https?):\/\/[-A-Z0-9+&amp;@#\/%?=~_|!:,.;]*[-A-Z0-9+&amp;@#\/%=~_|])/gi,e=t.replace(a,'<a class="colored-link-1" title="$1" href="$1" target="_blank">$1</a>'),r=/(^|[^\/])(www\.[\S]+(\b|$))/gim,e=e.replace(r,'$1<a class="colored-link-1" href="http://$2" target="_blank">$2</a>'),e=e.replace(/#(\S*)/g,'<a href="http://twitter.com/#!/search/$1"  target="_blank">#$1</a>'),e=e.replace(/@([a-z\d_]+)/gi,'<a href="http://twitter.com/$1">@$1</a>')}function returnTweetList(t){for(var e=[],a=0;a<t.length;a++){var r={};r.tweet=convertToLinks(t[a].text),r.id=t[a].id,r.id_str=t[a].id_str,r.name=t[a].user.name,t[a].entities.media&&(r.img=t[a].entities.media[0].media_url,r.imgUrl=t[a].entities.media[0].expanded_url),r.url="https://twitter.com/"+twitterHandle+"/status/"+t[a].id_str,r.date=new Date(t[a].created_at),r.dateParsed=parseTwitterDate(t[a].created_at),e.push(r)}return e}function parseTwitterDate(t){var e=new Date(Date.parse(t)),a=new Date;K.ie&&(e=Date.parse(t.replace(/( \+)/," UTC$1")));var r=Math.floor((a-e)/1e3);if(1>=r)return"just now";if(20>r)return r+" seconds ago";if(40>r)return"half a minute ago";if(60>r)return"less than a minute ago";if(90>=r)return"one minute ago";if(3540>=r)return Math.round(r/60)+" minutes ago";if(5400>=r)return"1 hour ago";if(86400>=r)return Math.round(r/3600)+" hours ago";if(129600>=r)return"1 day ago";if(604800>r)return Math.round(r/86400)+" days ago";if(1209600>=r)return"over a week ago";if(2629740>r)return Math.round(r/604800)+" weeks ago";var n=new Date(e);return"on "+(n.getMonth()+1)+"-"+n.getDate()+"-"+n.getFullYear()}var twitterHandle="jimcamut",tweetProxy="/twitter-proxy.php?url="+encodeURIComponent("statuses/user_timeline.json?screen_name="+twitterHandle+"&count=100&include_rts=false&exclude_replies=true"),numOfTweets=6,localData=JSON.parse(localStorage.getItem("twitterData"))||!1,dataStream,K=function(){var t=navigator.userAgent;return{ie:t.match(/MSIE\s([^;]*)/)}}();jQuery.noConflict(),jQuery(document).ready(function($){function t(){console.log("Twitter data is from localStorage."),dataStream=localData.data,a(dataStream)}function e(t){var e,a=$("<li data-id="+t.id+" class='new'><p class='tweet-head'><a href='https://twitter.com/"+t.name+"' target='_blank'>"+t.name+"</a> / "+t.dateParsed+"</p><p>"+t.tweet+"</p></li>"),r=$("<ul class='interact'><li><a href='https://twitter.com/intent/tweet?in_reply_to="+t.id_str+"'>Reply</a></li><li><a href='https://twitter.com/intent/retweet?tweet_id="+t.id_str+"'>Retweet</a></li><li><a href='https://twitter.com/intent/favorite?tweet_id="+t.id_str+"'>Favorite</a></li></ul>");return e=$(t.img?"<a href='"+t.imgUrl+"' class='tweet-img' target='_blank'><img src='"+t.img+"'  /></a>":"<a href='"+t.url+"' class='tweet-img bird' target='_blank'><img src='/assets/img/twitter-bird.png'  /></a>"),a.append(e),a.append(r),a}function a(t){$("#tweets .loader").hide(),$("#tweet-error").hide();var a=function(){var e=new jQuery.Deferred;return e.resolve(returnTweetList(t)),e.promise()};$.when(a()).then(function(t){var a;if(t&&(a=t),a)for(var r=0;numOfTweets>r;r++)if(a[r]){var n=e(a[r]);$("#tweetContainer").append(n)}else $("#tweet-error").show().html("Cannot display tweets at this time. Please try back later, or visit our Twitter page at <a href='https://twitter.com/"+twitterHandle+"' target='_blank'>https://twitter.com/"+twitterHandle+"</a>.");else $("#tweet-error").show().html("Cannot display tweets at this time. Please try back later, or visit our Twitter page at <a href='https://twitter.com/"+twitterHandle+"' target='_blank'>https://twitter.com/"+twitterHandle+"</a>.");var i=$("#tweetContainer > li");$.each(i,function(t,e){setTimeout(function(){$(e).addClass("added")},100*(t+1))})})}function r(t){function a(){var t=$("#tweetContainer > li").length,e=r.length,a=e-t;0>=a&&$("#more-tweets").hide()}var r=returnTweetList(dataStream),n=[];$("#tweetContainer > li").each(function(t,e){var a=$(e).data("id");n[t]=a}).promise().done(function(){for(var i=n.length+t,o=n.length;i>o;o++)if(r[o]){var s=e(r[o]);$("#tweetContainer").append(s)}else $("#tweet-error").show().html("Cannot display tweets at this time. Please try back later, or visit our Twitter page at <a href='https://twitter.com/"+twitterHandle+"' target='_blank'>https://twitter.com/"+twitterHandle+"</a>.");var l=$("#tweetContainer > li.new");$.each(l,function(t,e){setTimeout(function(){$(e).addClass("added").removeClass("new")},100*(t+1))}),a()})}function n(){$.ajax({type:"GET",url:tweetProxy,success:function(t){dataStream=t,a(t),console.log("Twitter data is fresh from the Twitter API.");var e={};e.updated=new Date,e.data=t,localStorage.setItem("twitterData",JSON.stringify(e))},error:function(t){$("#tweet-error").show().html("Cannot display tweets at this time. Please try back later, or visit our Twitter page at <a href='https://twitter.com/"+twitterHandle+"' target='_blank'>https://twitter.com/"+twitterHandle+"</a>."),console.log("getTweets error"),console.log(t)}})}function i(){$.ajax({type:"GET",url:tweetProxy,success:function(t){var e=t,a=[],r=function(){function t(){return $("#tweetContainer li").each(function(t,e){var r=$(e).data("id");a.push(r)}),a}var e=new jQuery.Deferred;return e.resolve(t()),e.promise()};$.when(r()).then(function(t){for(var a=t,r=0;r<a.length;r++){for(var n=0;n<e.length;n++)e[n].id===a[r]&&e.splice(n,1);if(r===a.length-1){e.reverse();for(var i=0;i<e.length;i++){var o=convertToLinks(e[i].text);$("#tweetContainer").prepend("<li class='new' data-id="+e[i].id+">"+o+"</li>")}$("#tweetContainer > li.new").addClass("added")}}})},error:function(t){console.log("newest Tweets error"),console.log(t)}})}if(0===$("#tweetContainer li").length){var o=new Date,s=6e4,l=10*s,c=function(){return localData?Date.parse(localData.updated):l+1};o-c()>=l||0===localData.data.length?setTimeout(n,500):setTimeout(t,500)}$("#more-tweets").click(function(t){t.preventDefault(),r(numOfTweets)})});